---
title: "Sistem za izposojo koles Capital Bikeshare"
author: "Janez Podlogar"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```


## Izbira teme in cilji

Capital Bikeshare je sistem za izposojo koles, ki se nahaja v Washington, D.C. in okolici. Po velikosti je tretji največji v Združenih državah Amerike.

S povečovanjem pomena javnega prometa v povezavi z prehodom v brezogljično družbo so sistemi izposoje koles ena izmed rešitev zagotavljanlja mobilnosti na tranjostni način. Skupaj z nadgradnjo kolesarske infrastrukture (pogosto v škodo avtomobilom) postajajo kolesarji vse pomembnejši udeleženci v prometu. Obnašanje kolesarjev je, zato ključnega pomena za urbaniste in mestne odločevalce, ki poizkušajo izboljšati mestno infrastukturo in se hkrati spopasti z avtomobilskimi izpuhi.

Analiza omrežja in izposoje koles je zanimva prevsem v okviru dnevnih in sezonskih vremenskih vplivov. Prav tako je zanimiva v širšem kontekstu pandemije SARS-CoV-2, saj je le ta nenadno in korenito spremenila naše vsakodnevne navade.

Cilj projekta je preučiti rast sistema skozi leta 2010 vse do vključno leta 2021. Sproti bomo analizirali vpliv vremena na obnašanje uporavnikov ter si pogledali vpliv epidemije v v letih 2020 in 2012. Za konec bomo naredili tudi napovedni model za število voženj v sistemu glede na vremenske razmere in številom primerov Covida.

<center>
![](slike/DC.jpg)

## Obdelava, uvoz in čiščenje podatkov

```{r uvoz}
source("uvoz/uvoz.r", encoding="UTF-8")
```

Podatki o izposojah koles sistema *Capital Bikeshare* so dostopni na [Amazon Web Service](https://s3.amazonaws.com/capitalbikeshare-data/index.html) v obliki CSV. Podatke sem prečistil in preuredil v primerno obliko za nadaljno analizo.

Vremenske podatke sem pridobil od *National Oceanic and Atmospheric Administration* in sicer z vremenske postaje letališča [Ronald Reagan Washington National Airport](https://www.ncdc.noaa.gov/cdo-web/datasets/GHCND/stations/GHCND:USW00013743/detail).

Podatke o epidimiji Covida sem pridobil z [Github repozitorija](https://github.com/nytimes/covid-19-data) častnika *New York Times*, ki jih uporablja za generiranja [sledilnika Covida](https://www.nytimes.com/interactive/2021/us/covid-cases.html)

Vse podatke sem prečistil in preuredil v primerno obliko za nadaljno analizo. Temeljiti opisi in rešeitve vseh problemov na katere sem naletel med uvozom in obdelavo podatkov so zapisani v komentarjih med kodo.

### Tabele

Prve štiri tabele predstavljajo prečiščene podatke. Tabele poimenovane tblG* sem uporabljal za risanje grafov, tabele poimenovane tblZ* za risanje zemljevidov ter tabelo tblM za napredno analizo podatkov.

1. **tbCB** - Vsebuje podatke o vsaki posamezni izposoji:
- `duration` - skupni čas izposoje
- `started_at` - datum in ura izposoje
- `ended_at` - datum in ura vrnitve
- `start_station_id` - postaja izposoje
- `end_station_id` - postaja vrnitve
- `member_type` - tip uporabnika
- `rideable_type` - tip kolesa

2. **postaje** - Vsebuje podatke o kolesarskih postajah
- `station_id` - identifikacijska številka 
- `station_name` - ime 
- `lat` - zemljepisna širina
- `lng` - zemljepisna dolžina

3. **noaa** - Prečiščeni in obdelani vremenski podatki
- `date` - dan meritve
- `awnd` - povprečna hitrost vetra
- `prcp` - padavine
- `snow` - sneženje
- `snwd` - globina snega
- `tavg` - povprečna temperatura
- `tmax` - najvišja temperatura
- `tmin` - najnižnja temperatura
- `wt**` - klasifikacije vremena

4. **tblCV** - Prečiščeni podatki o pandemiji SARS-CoV-2
- `date` - dan meritve
- `cases_total` - komulativno število potrjenih primerov okužbe
- `deaths_today` - komulativno število smrti
- `deaths_today` - število smrti na dan
- `cases_today` - število okužb na dan
- `cases_incidence` - štirinajstdnevna pojavnost okužb

5. **tblG1** - Vsebuje agregirane podatke glede na datum, tip naročnine in tip kolesa
- `year` - leto izposoje
- `month` - mesec izposoje
- `season` - letni čas izposoje
- `day` - dan v tednu izposoje
- `member_type` - tip uporabnika
- `rideable_type` - tip kolesa
- `date` - datum izposoje
- `n` - število izposoj 
- `dur` - skupni čas izposoje
- `dur_avg` - povprečni čas izposoje

6. **tblG2** - Vsebuje agregirane podatke po vseh možnih relacijah med postajami
- `start_station_id` - skupni čas izposoje
- `end_station_id` - leto izposoje
- `n` - mesec izposoje
- `dur` - letni čas izposoje
- `dur_avg` - dan v tednu izposoje
- `member_type` - tip uporabnika
- `rideable_type` - tip kolesa
- `start_station_id` - postaja izposoje
- `end_station_id` - postaja vrnitve

7. **tblG3** - Vsebuje podatke o vsaki posamezni vožnji
- `date` - datum izposoje
- `hour` - ura izposoje
- `time_of_day` - del dneva (Noč, Jutro, Popoldan, Večer)
- `duration` - čas izposoje
- `member_type` - tip uporabnika
- `rideable_type` - tip kolesa

8. **tblG4** - Združuje podatke iz tabel tblG1 in tblCV

9. **tblG5** - Združuje podatke iz tabel tblG1 in noaa

10. **tblZ1** - 10 najpopularnejših postaj za izposojo kolesa

11. **tblZ2** - 10 najpopularnejših postaj za vrnitev kolesa

12. **tblM** - Združitev tabel tblG1, tblCV in noaa

***

## Analiza in vizualizacija podatkov

### Vizualizacija kolesarskega omrežja

Začeli bomo z analizo voženj in postaj

```{r vizualizacija, results='hide'}
source("vizualizacija/vizualizacija.r", encoding="UTF-8")
```

```{r, figures-a, fig.show="hold", out.width="50%"}
par(mar = c(4, 4, .1, .1))
print(graf1)
print(graf2)
```

Prvi graf v celoti ustreza našim pričakovanjem. Število voženj se z časom (in rastjo omrežja) povečuje in v letih, ko nastopi pandemija silovito pade, a se naslednje leto že skoraj povrne na predpandemično raven. Prav tako je smiselno, da se člani. Malce nas preseneti, da v letih 2020 upade število voženj, ki jih opravijo člani, a število voženj nečlanov naraste. Morda so ljudje zaradi omejitev (delo od doma) kolesarili manj in se jim je zato bolj splačalo plačat dražjo posamezno vožnjo in prišparati denar pri naročnini.

Drugi graf nas že malo preseneti. Čeprav nečlani opravijo manj voženj, se vozijo dlje časa. Zanimivo je, da se je navkljub upadu vozenj v letih 2020 in 2021 skupni čas izposoje povečal. Ugibamo, da so ljudje raje namesto avtobusa in ostalih potniških storitev tudi za daljše prevoze posegli po kolesu pa čeprav manjkrat. Morda so si kolo izposodili za daljše rekreacijske vožnje in ne za vsakodnevne vožnje v službo in nazaj.

```{r}
print(graf5)
```

Sklepamo lahko, da člani uporabljajo kolesa predvsem za prevoz na delo. Nečlani pa ga uporabljajo za bolj priložnostno in rekreacijsko.

```{r}
print(graf6)
```

Električna kolesa se prvič pojavijo v mesecu Juliju 2020. Zanimivo bi bilo opazovati rast uporabe električnih koles v prihajajočih letih.

```{r}
print(graf3)
```

Osredotočimo se na zadnja štiri leta. Pričakovano je povprečni čas vožnje višji za nečlane kot za člane. Člani se tudi obnašajo bolj konstantno skozi vse letne čase. 

```{r}
print(graf4)
```

Poglejmo še število voženj po mesecih. Opazimo, da nam natančnješa delitev na mesece ne poda več informativnosti kot delitev na letni čas. Opazimo tudi očiten vpliv Covid-19 v mesecu marcu in aprilu 2020. Po vzorcu prejšnjih dveh let bi moralo število voženj članov sunkovito narasti, a namesto tega pade. Po drugi strani pa število voženj nečlanov naraste bolj kot leta poprej.

```{r}
print(graf7)
```

Če na prejšnji graf vnesemo še podatke o povprečni 14 dnevni incidenca, vidimo, da se v prvem valu močno zmanjša število voženj. Poleti, ko je primrov Covida manj se tudi število voženj poveča. Pozimi ob drugem valu pa se ponovno zniža bolj kot v letih poprej. V letu 2022 je število voženj bistveno manj odvisno od števila primerov kot v letu 2021, saj se je tako odnos kot tudi pandemija sama korenito spremenila.

***
